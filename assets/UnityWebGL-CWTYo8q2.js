import{r as x,a as H,j as R}from"./index-DES_R0BH.js";var $={},I={},S={},B;function J(){if(B)return S;B=1,Object.defineProperty(S,"__esModule",{value:!0}),S.useCanvasIdentifier=void 0;var a=x(),y=0,f="react-unity-webgl-canvas",s=function(m){var i=(0,a.useState)(0),e=i[0],r=i[1],n=(0,a.useCallback)(function(){r(function(c){return c+1})},[]);if(m!==void 0)return[m,n];var o=(0,a.useMemo)(function(){return[f,y].join("-")},[e]);return[o,n]};return S.useCanvasIdentifier=s,S}var k={},M={},D;function T(){return D||(D=1,Object.defineProperty(M,"__esModule",{value:!0}),M.isBrowserEnvironment=void 0,M.isBrowserEnvironment=typeof window<"u"&&typeof document<"u"),M}var G;function K(){if(G)return k;G=1,Object.defineProperty(k,"__esModule",{value:!0}),k.useUnityLoader=void 0;var a=x(),y=T(),f=function(s){var m=(0,a.useState)("Loading"),i=m[0],e=m[1];return(0,a.useEffect)(function(){if(y.isBrowserEnvironment!==!1){if(s===null){e("Idle");return}var r=window.document.querySelector('script[src="'.concat(s,'"]'));r===null?(r=window.document.createElement("script"),r.type="text/javascript",r.src=s,r.async=!0,r.setAttribute("data-status","loading"),window.document.body.appendChild(r),r.addEventListener("load",function(){return r==null?void 0:r.setAttribute("data-status","loaded")}),r.addEventListener("error",function(){return r==null?void 0:r.setAttribute("data-status","error")})):e(r.getAttribute("data-status")==="loaded"?"Loaded":"Error");var n=function(o){return e(o.type==="load"?"Loaded":"Error")};return r.addEventListener("load",n),r.addEventListener("error",n),function(){r!==null&&(r.removeEventListener("load",n),r.removeEventListener("error",n),r.remove())}}},[s]),i};return k.useUnityLoader=f,k}var z;function X(){if(z)return I;z=1;var a=I&&I.__awaiter||function(e,r,n,o){function c(t){return t instanceof n?t:new n(function(l){l(t)})}return new(n||(n=Promise))(function(t,l){function d(U){try{u(o.next(U))}catch(P){l(P)}}function h(U){try{u(o.throw(U))}catch(P){l(P)}}function u(U){U.done?t(U.value):c(U.value).then(d,h)}u((o=o.apply(e,r||[])).next())})},y=I&&I.__generator||function(e,r){var n={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},o,c,t,l=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return l.next=d(0),l.throw=d(1),l.return=d(2),typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function d(u){return function(U){return h([u,U])}}function h(u){if(o)throw new TypeError("Generator is already executing.");for(;l&&(l=0,u[0]&&(n=0)),n;)try{if(o=1,c&&(t=u[0]&2?c.return:u[0]?c.throw||((t=c.return)&&t.call(c),0):c.next)&&!(t=t.call(c,u[1])).done)return t;switch(c=0,t&&(u=[u[0]&2,t.value]),u[0]){case 0:case 1:t=u;break;case 4:return n.label++,{value:u[1],done:!1};case 5:n.label++,c=u[1],u=[0];continue;case 7:u=n.ops.pop(),n.trys.pop();continue;default:if(t=n.trys,!(t=t.length>0&&t[t.length-1])&&(u[0]===6||u[0]===2)){n=0;continue}if(u[0]===3&&(!t||u[1]>t[0]&&u[1]<t[3])){n.label=u[1];break}if(u[0]===6&&n.label<t[1]){n.label=t[1],t=u;break}if(t&&n.label<t[2]){n.label=t[2],n.ops.push(u);break}t[2]&&n.ops.pop(),n.trys.pop();continue}u=r.call(e,n)}catch(U){u=[6,U],c=0}finally{o=t=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}};Object.defineProperty(I,"__esModule",{value:!0}),I.Unity=void 0;var f=x(),s=J(),m=K(),i=(0,f.forwardRef)(function(e,r){var n=(0,f.useState)(null),o=n[0],c=n[1],t=(0,f.useState)(null),l=t[0],d=t[1],h=(0,s.useCanvasIdentifier)(e.id),u=h[0],U=h[1],P=(0,m.useUnityLoader)(e.unityProvider.loaderUrl),A=(0,f.useCallback)(function(C){e.unityProvider.setLoadingProgression(C),C===1&&e.unityProvider.setIsLoaded(!0)},[e.unityProvider]);return(0,f.useEffect)(function(){var C=function(){return a(void 0,void 0,void 0,function(){var b,E,w,v,g;return y(this,function(_){switch(_.label){case 0:if(!o||l||P!=="Loaded")return[2];console.log("React Unity WebGL: Initializing Unity instance..."),e.unityProvider.setUnityInstance(null),d(null),e.unityProvider.setLoadingProgression(0),(g=(v=e.unityProvider).setIsLoaded)===null||g===void 0||g.call(v,!1),e.unityProvider.setInitialisationError(void 0),U(),b={companyName:e.unityProvider.companyName,productName:e.unityProvider.productName,productVersion:e.unityProvider.productVersion,dataUrl:e.unityProvider.dataUrl,frameworkUrl:e.unityProvider.frameworkUrl,codeUrl:e.unityProvider.codeUrl,workerUrl:e.unityProvider.workerUrl,memoryUrl:e.unityProvider.memoryUrl,symbolsUrl:e.unityProvider.symbolsUrl,streamingAssetsUrl:e.unityProvider.streamingAssetsUrl,devicePixelRatio:e.devicePixelRatio,webglContextAttributes:e.unityProvider.webglContextAttributes,cacheControl:e.unityProvider.cacheControl,autoSyncPersistentDataPath:e.unityProvider.autoSyncPersistentDataPath,matchWebGLToCanvasSize:e.matchWebGLToCanvasSize,disabledCanvasEvents:e.disabledCanvasEvents},Object.keys(b).forEach(function(N){(b[N]===null||b[N]===void 0)&&delete b[N]}),_.label=1;case 1:return _.trys.push([1,3,,4]),[4,window.createUnityInstance(o,b,A)];case 2:return E=_.sent(),d(E),e.unityProvider.setUnityInstance(E),[3,4];case 3:return w=_.sent(),console.error("React Unity WebGL: Error initializing Unity instance:",w),e.unityProvider.setInitialisationError(w),[3,4];case 4:return[2]}})})},O=function(){return a(void 0,void 0,void 0,function(){var b,E,w;return y(this,function(v){switch(v.label){case 0:return!l||!o?[2]:(console.log("React Unity WebGL: Detaching Unity instance..."),e.unityProvider.setUnityInstance(null),d(null),e.unityProvider.setLoadingProgression(0),(w=(E=e.unityProvider).setIsLoaded)===null||w===void 0||w.call(E,!1),e.unityProvider.setInitialisationError(void 0),b=document.createElement("canvas"),b.id=o.id,b.setAttribute("react-unity-webgl-role","cleanup"),b.style.display="none",document.body.appendChild(b),l.Module.canvas=b,d(null),[4,l.Quit()]);case 1:return v.sent(),document.body.removeChild(b),[2]}})})};return C(),function(){O()}},[o,l,P,e.unityProvider]),(0,f.useImperativeHandle)(r,function(){return o}),(0,f.createElement)("canvas",{ref:c,id:u,style:e.style,className:e.className,tabIndex:e.tabIndex})});return I.Unity=i,I}var j={},L={},F;function Y(){if(F)return L;F=1;var a=L&&L.__spreadArray||function(e,r,n){if(n||arguments.length===2)for(var o=0,c=r.length,t;o<c;o++)(t||!(o in r))&&(t||(t=Array.prototype.slice.call(r,0,o)),t[o]=r[o]);return e.concat(t||Array.prototype.slice.call(r))};Object.defineProperty(L,"__esModule",{value:!0}),L.useEventSystem=void 0;var y=x(),f=T(),s=[],m=function(e){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];var o=void 0;return s.forEach(function(c){o=c.apply(void 0,a([e],r,!1))}),o};f.isBrowserEnvironment===!0&&(window.dispatchReactUnityEvent=m);var i=function(){var e=(0,y.useRef)([]),r=(0,y.useCallback)(function(c,t){e.current=a(a([],e.current,!0),[{eventName:c,callback:t}],!1)},[e]),n=(0,y.useCallback)(function(c,t){e.current=e.current.filter(function(l){return l.eventName!==c&&l.callback!==t})},[e]),o=(0,y.useCallback)(function(c){for(var t=[],l=1;l<arguments.length;l++)t[l-1]=arguments[l];var d=e.current.find(function(h){return h.eventName===c});if(!(typeof d>"u"))return d.callback.apply(d,t)},[e]);return(0,y.useEffect)(function(){return s.push(o),function(){s.splice(s.indexOf(o),1)}},[o]),{addEventListener:r,removeEventListener:n}};return L.useEventSystem=i,L}var V;function Z(){if(V)return j;V=1,Object.defineProperty(j,"__esModule",{value:!0}),j.useUnityContext=void 0;var a=x(),y=Y(),f=function(s){var m=(0,a.useState)(null),i=m[0],e=m[1],r=(0,a.useState)(0),n=r[0],o=r[1],c=(0,a.useState)(!1),t=c[0],l=c[1],d=(0,a.useState)(),h=d[0],u=d[1],U=(0,y.useEventSystem)(),P=(0,a.useRef)({companyName:s.companyName,productName:s.productName,productVersion:s.productVersion,codeUrl:s.codeUrl,dataUrl:s.dataUrl,frameworkUrl:s.frameworkUrl,loaderUrl:s.loaderUrl,memoryUrl:s.memoryUrl,symbolsUrl:s.symbolsUrl,streamingAssetsUrl:s.streamingAssetsUrl,workerUrl:s.workerUrl,webglContextAttributes:s.webglContextAttributes,cacheControl:s.cacheControl,autoSyncPersistentDataPath:s.autoSyncPersistentDataPath,setUnityInstance:e,setLoadingProgression:o,setIsLoaded:l,setInitialisationError:u}),A=(0,a.useCallback)(function(v){return i==null?void 0:i.SetFullscreen(v?1:0)},[i]),C=(0,a.useCallback)(function(){var v;return(v=i==null?void 0:i.Module.canvas)===null||v===void 0?void 0:v.requestPointerLock()},[i]),O=(0,a.useCallback)(function(v,g,_){return i==null?void 0:i.SendMessage(v,g,_)},[i]),b=(0,a.useCallback)(function(v,g){var _;return(_=i==null?void 0:i.Module.canvas)===null||_===void 0?void 0:_.toDataURL(v,g)},[i]),E=(0,a.useCallback)(function(){var v;return(v=i==null?void 0:i.Quit())!==null&&v!==void 0?v:Promise.reject()},[i]),w=(0,a.useCallback)(function(){var v;return(v=i==null?void 0:i.GetMetricsInfo)===null||v===void 0?void 0:v.call(i)},[i]);return{unityProvider:P.current,loadingProgression:n,isLoaded:t,initialisationError:h,requestFullscreen:A,requestPointerLock:C,sendMessage:O,takeScreenshot:b,unload:E,getMetricsInfo:w,addEventListener:U.addEventListener,removeEventListener:U.removeEventListener,UNSAFE__unityInstance:i}};return j.useUnityContext=f,j}var q={},W;function ee(){if(W)return q;W=1,Object.defineProperty(q,"__esModule",{value:!0}),q.useUnityMetricsInfo=void 0;var a=x(),y=function(f,s){var m=(0,a.useState)({}),i=m[0],e=m[1];return(0,a.useEffect)(function(){var r=setInterval(function(){var n=f();typeof n>"u"||e(n)},s.interval||1e3);return function(){clearInterval(r)}},[f,s.interval]),i};return q.useUnityMetricsInfo=y,q}var Q;function te(){return Q||(Q=1,function(a){Object.defineProperty(a,"__esModule",{value:!0}),a.useUnityMetricsInfo=a.useUnityContext=a.Unity=void 0;var y=X();Object.defineProperty(a,"Unity",{enumerable:!0,get:function(){return y.Unity}});var f=Z();Object.defineProperty(a,"useUnityContext",{enumerable:!0,get:function(){return f.useUnityContext}});var s=ee();Object.defineProperty(a,"useUnityMetricsInfo",{enumerable:!0,get:function(){return s.useUnityMetricsInfo}})}($)),$}var p=te();function re({BuildUrl:a,appName:y,height:f=600,width:s="100%",streamingAssetsUrl:m=void 0}){const i=`${a}/${encodeURIComponent(y)}`,e=`${i}.loader.js`,r=`${i}.data`,n=`${i}.framework.js`,o=`${i}.wasm`;console.log("StreamingUrl:",m);const{unityProvider:c,loadingProgression:t,isLoaded:l}=p.useUnityContext({loaderUrl:e,dataUrl:r,frameworkUrl:n,codeUrl:o,streamingAssetsUrl:m});return H.useEffect(()=>()=>{try{const d=c;if(!d)return;const h=d._unityInstance??(typeof d.getInstance=="function"?d.getInstance():null);if(h&&typeof h.Quit=="function")h.Quit().catch(()=>{});else if(typeof d.unload=="function")d.unload().catch(()=>{});else try{window.Module&&typeof window.Module.quit=="function"&&window.Module.quit()}catch{}}catch(d){console.warn("Unity cleanup attempt failed:",d)}},[c]),R.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",width:"100%",height:"100%",overflow:"visible"},children:R.jsxs("div",{style:{width:s,height:f,transformOrigin:"top center",background:"#000",position:"relative",overflow:"visible"},children:[R.jsx(p.Unity,{unityProvider:c,style:{width:"100%",height:"100%"}}),!l&&R.jsxs("div",{style:{position:"absolute",left:12,bottom:12,color:"#fff"},children:["Loading ",Math.round(t*100),"%"]})]})})}export{re as default};
